@page "/help"
@inject ISnackbar Snackbar
@rendermode InteractiveServer

<PageTitle>Help & Support - SRMS</PageTitle>

<MudPaper class="animate-fade-in modern-card">
    <!-- Header -->
    <MudPaper class="text-center mb-6">
        <MudText Typo="Typo.h3" Class="text-gradient mb-2 font-bold">
            <MudIcon Icon="@Icons.Material.Filled.Help" Size="Size.Large" Class="mr-2" />
            Help & Support
        </MudText>
        <MudText Typo="Typo.body1" Color="Color.Secondary">
            We're here to help! Find answers to common questions or contact our support team.
        </MudText>
    </MudPaper>

    <!-- Search Bar -->
    <MudPaper Class="glass-card pa-4 mb-6">
        <MudTextField 
            @bind-Value="_searchQuery"
            Placeholder="Search for help articles..."
            Variant="Variant.Outlined"
            Adornment="Adornment.Start"
            AdornmentIcon="@Icons.Material.Filled.Search"
            FullWidth="true"
            OnKeyUp="SearchArticles" />
    </MudPaper>

    <MudGrid>
        <!-- Quick Actions -->
        <MudItem xs="12">
            <MudText Typo="Typo.h5" Class="mb-4">Quick Actions</MudText>
            <MudGrid>
                <MudItem xs="12" sm="6" md="3">
                    <MudPaper Class="modern-card hover-lift p-4 text-center cursor-pointer" @onclick="OpenContactSupport">
                        <MudIcon Icon="@Icons.Material.Filled.Email" Color="Color.Primary" Size="Size.Large" />
                        <MudText Typo="Typo.h6" Class="mt-2">Contact Support</MudText>
                        <MudText Typo="Typo.body2" Color="Color.Secondary">Get in touch with us</MudText>
                    </MudPaper>
                </MudItem>
                <MudItem xs="12" sm="6" md="3">
                    <MudPaper Class="modern-card hover-lift pa-4 text-center" Style="cursor: pointer;" @onclick="OpenLiveChat">
                        <MudIcon Icon="@Icons.Material.Filled.Chat" Color="Color.Success" Size="Size.Large" />
                        <MudText Typo="Typo.h6" Class="mt-2">Live Chat</MudText>
                        <MudText Typo="Typo.body2" Color="Color.Secondary">Chat with our team</MudText>
                    </MudPaper>
                </MudItem>
                <MudItem xs="12" sm="6" md="3">
                    <MudPaper Class="modern-card hover-lift pa-4 text-center" Style="cursor: pointer;" @onclick="OpenDocumentation">
                        <MudIcon Icon="@Icons.Material.Filled.MenuBook" Color="Color.Info" Size="Size.Large" />
                        <MudText Typo="Typo.h6" Class="mt-2">Documentation</MudText>
                        <MudText Typo="Typo.body2" Color="Color.Secondary">Read our guides</MudText>
                    </MudPaper>
                </MudItem>
                <MudItem xs="12" sm="6" md="3">
                    <MudPaper Class="modern-card hover-lift pa-4 text-center" Style="cursor: pointer;" @onclick="OpenVideoTutorials">
                        <MudIcon Icon="@Icons.Material.Filled.VideoLibrary" Color="Color.Warning" Size="Size.Large" />
                        <MudText Typo="Typo.h6" Class="mt-2">Video Tutorials</MudText>
                        <MudText Typo="Typo.body2" Color="Color.Secondary">Watch and learn</MudText>
                    </MudPaper>
                </MudItem>
            </MudGrid>
        </MudItem>

        <!-- FAQ Section -->
        <MudItem xs="12" md="8">
            <MudText Typo="Typo.h5" Class="mb-4">Frequently Asked Questions</MudText>
            <MudPaper Class="glass-card pa-4">
                <MudExpansionPanels MultiExpansion="true">
                    @foreach (var faq in _faqs)
                    {
                        <MudExpansionPanel>
                            <TitleContent>
                                <MudPaper Class="flex align-items-center">
                                    <MudIcon Icon="@faq.Icon" Color="@faq.Color" Class="mr-3" />
                                    <MudText Typo="Typo.body1" Class="font-semibold">@faq.Question</MudText>
                                </MudPaper>
                            </TitleContent>
                            <ChildContent>
                                <MudText Typo="Typo.body2" Color="Color.Secondary">
                                    @faq.Answer
                                </MudText>
                            </ChildContent>
                        </MudExpansionPanel>
                    }
                </MudExpansionPanels>
            </MudPaper>
        </MudItem>

        <!-- Contact Information -->
        <MudItem xs="12" md="4">
            <MudText Typo="Typo.h5" Class="mb-4">Contact Information</MudText>
            
            <MudPaper Class="glass-card pa-4 mb-4">
                <MudStack Spacing="3">
                    <MudPaper Class="flex align-items-center">
                        <MudIcon Icon="@Icons.Material.Filled.Email" Color="Color.Primary" Class="mr-3" />
                        <MudPaper>
                            <MudText Typo="Typo.caption" Color="Color.Secondary">Email</MudText>
                            <MudText Typo="Typo.body2">support@srms.com</MudText>
                        </MudPaper>
                    </MudPaper>
                    <MudDivider />
                    <MudPaper Class="flex align-items-center">
                        <MudIcon Icon="@Icons.Material.Filled.Phone" Color="Color.Success" Class="mr-3" />
                        <MudPaper>
                            <MudText Typo="Typo.caption" Color="Color.Secondary">Phone</MudText>
                            <MudText Typo="Typo.body2">+1 (555) 123-4567</MudText>
                        </MudPaper>
                    </MudPaper>
                    <MudDivider />
                    <MudPaper Class="flex align-items-center">
                        <MudIcon Icon="@Icons.Material.Filled.LocationOn" Color="Color.Error" Class="mr-3" />
                        <MudPaper>
                            <MudText Typo="Typo.caption" Color="Color.Secondary">Address</MudText>
                            <MudText Typo="Typo.body2">123 University Ave, City</MudText>
                        </MudPaper>
                    </MudPaper>
                    <MudDivider />
                    <MudPaper Class="flex align-items-center">
                        <MudIcon Icon="@Icons.Material.Filled.Schedule" Color="Color.Info" Class="mr-3" />
                        <MudPaper>
                            <MudText Typo="Typo.caption" Color="Color.Secondary">Support Hours</MudText>
                            <MudText Typo="Typo.body2">Mon-Fri: 9AM - 6PM</MudText>
                        </MudPaper>
                    </MudPaper>
                </MudStack>
            </MudPaper>

            <!-- System Status -->
            <MudPaper Class="glass-card pa-4">
                <MudText Typo="Typo.h6" Class="mb-3">System Status</MudText>
                <MudStack Spacing="2">
                    <MudPaper Class="flex justify-content-between align-items-center">
                        <MudText Typo="Typo.body2">API Server</MudText>
                        <MudChip T="string" Color="Color.Success" Size="Size.Small">
                            <span class="status-dot status-online"></span>
                            Online
                        </MudChip>
                    </MudPaper>
                    <MudPaper Class="flex justify-content-between align-items-center">
                        <MudText Typo="Typo.body2">Database</MudText>
                        <MudChip T="string" Color="Color.Success" Size="Size.Small">
                            <span class="status-dot status-online"></span>
                            Online
                        </MudChip>
                    </MudPaper>
                    <MudPaper Class="flex justify-content-between align-items-center">
                        <MudText Typo="Typo.body2">Email Service</MudText>
                        <MudChip T="string" Color="Color.Success" Size="Size.Small">
                            <span class="status-dot status-online"></span>
                            Online
                        </MudChip>
                    </MudPaper>
                </MudStack>
            </MudPaper>
        </MudItem>

        <!-- Popular Topics -->
        <MudItem xs="12">
            <MudText Typo="Typo.h5" Class="mb-4">Popular Topics</MudText>
            <MudGrid>
                @foreach (var topic in _popularTopics)
                {
                    <MudItem xs="12" sm="6" md="4">
                        <MudPaper Class="modern-card hover-lift pa-4" Style="cursor: pointer;" @onclick="() => ViewTopic(topic)">
                            <MudIcon Icon="@topic.Icon" Color="@topic.Color" Size="Size.Medium" Class="mb-2" />
                            <MudText Typo="Typo.h6">@topic.Title</MudText>
                            <MudText Typo="Typo.body2" Color="Color.Secondary">@topic.Description</MudText>
                            <MudText Typo="Typo.caption" Color="Color.Tertiary" Class="mt-2">
                                @topic.ArticleCount articles
                            </MudText>
                        </MudPaper>
                    </MudItem>
                }
            </MudGrid>
        </MudItem>
    </MudGrid>
</MudPaper>

@code {
    private string _searchQuery = "";
    private List<FaqModel> _faqs = new();
    private List<TopicModel> _popularTopics = new();

    protected override void OnInitialized()
    {
        LoadFaqs();
        LoadPopularTopics();
    }

    private void LoadFaqs()
    {
        _faqs = new List<FaqModel>
        {
            new FaqModel
            {
                Question = "How do I register for a room?",
                Answer = "To register for a room, navigate to the Student Portal and click on 'My Room'. Follow the registration process and select your preferred room from the available options.",
                Icon = Icons.Material.Filled.MeetingRoom,
                Color = Color.Primary
            },
            new FaqModel
            {
                Question = "How can I make a payment?",
                Answer = "Go to 'My Payments' in the Student Portal. You can view your payment history and make new payments using various payment methods including credit card, bank transfer, or mobile payment.",
                Icon = Icons.Material.Filled.Payment,
                Color = Color.Success
            },
            new FaqModel
            {
                Question = "How do I submit a complaint?",
                Answer = "Navigate to 'My Complaints' in the Student Portal and click 'New Complaint'. Fill in the details of your issue and submit. You'll receive updates on the status of your complaint.",
                Icon = Icons.Material.Filled.Report,
                Color = Color.Warning
            },
            new FaqModel
            {
                Question = "How do I reset my password?",
                Answer = "Click on 'Forgot Password' on the login page. Enter your email address and you'll receive a password reset link. Follow the instructions in the email to set a new password.",
                Icon = Icons.Material.Filled.Lock,
                Color = Color.Error
            },
            new FaqModel
            {
                Question = "Can I change my room after registration?",
                Answer = "Room changes are subject to availability and approval. Contact your residence manager to request a room change. They will review your request and notify you of the decision.",
                Icon = Icons.Material.Filled.SwapHoriz,
                Color = Color.Info
            }
        };
    }

    private void LoadPopularTopics()
    {
        _popularTopics = new List<TopicModel>
        {
            new TopicModel
            {
                Title = "Getting Started",
                Description = "Learn the basics of using SRMS",
                Icon = Icons.Material.Filled.Rocket,
                Color = Color.Primary,
                ArticleCount = 12
            },
            new TopicModel
            {
                Title = "Room Management",
                Description = "Everything about rooms and bookings",
                Icon = Icons.Material.Filled.MeetingRoom,
                Color = Color.Success,
                ArticleCount = 8
            },
            new TopicModel
            {
                Title = "Payments & Billing",
                Description = "Payment methods and billing info",
                Icon = Icons.Material.Filled.Payment,
                Color = Color.Info,
                ArticleCount = 6
            },
            new TopicModel
            {
                Title = "Account Settings",
                Description = "Manage your account preferences",
                Icon = Icons.Material.Filled.Settings,
                Color = Color.Warning,
                ArticleCount = 10
            },
            new TopicModel
            {
                Title = "Complaints & Support",
                Description = "How to get help when you need it",
                Icon = Icons.Material.Filled.Support,
                Color = Color.Error,
                ArticleCount = 5
            },
            new TopicModel
            {
                Title = "Security & Privacy",
                Description = "Keep your account safe and secure",
                Icon = Icons.Material.Filled.Security,
                Color = Color.Secondary,
                ArticleCount = 7
            }
        };
    }

    private void SearchArticles(KeyboardEventArgs e)
    {
        if (e.Key == "Enter" && !string.IsNullOrWhiteSpace(_searchQuery))
        {
            Snackbar.Add($"Searching for: {_searchQuery}", Severity.Info);
        }
    }

    private void OpenContactSupport()
    {
        Snackbar.Add("Opening contact form...", Severity.Info);
    }

    private void OpenLiveChat()
    {
        Snackbar.Add("Live chat feature coming soon!", Severity.Info);
    }

    private void OpenDocumentation()
    {
        Snackbar.Add("Opening documentation...", Severity.Info);
    }

    private void OpenVideoTutorials()
    {
        Snackbar.Add("Opening video tutorials...", Severity.Info);
    }

    private void ViewTopic(TopicModel topic)
    {
        Snackbar.Add($"Viewing topic: {topic.Title}", Severity.Info);
    }

    private class FaqModel
    {
        public string Question { get; set; } = string.Empty;
        public string Answer { get; set; } = string.Empty;
        public string Icon { get; set; } = Icons.Material.Filled.Help;
        public Color Color { get; set; } = Color.Default;
    }

    private class TopicModel
    {
        public string Title { get; set; } = string.Empty;
        public string Description { get; set; } = string.Empty;
        public string Icon { get; set; } = Icons.Material.Filled.Topic;
        public Color Color { get; set; } = Color.Default;
        public int ArticleCount { get; set; }
    }
}
