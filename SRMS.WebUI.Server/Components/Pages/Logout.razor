@page "/logout"
@inject AuthenticationStateProvider AuthStateProvider
@inject NavigationManager Navigation
@using Microsoft.Extensions.Localization
@using SRMS.WebUI.Server.Resources
@inject IStringLocalizer<Resource> L

<PageTitle>@L["Logout_PageTitle"]</PageTitle>

<MudContainer MaxWidth="MaxWidth.Small" Class="min-h-screen flex items-center justify-center">
    <MudPaper Elevation="0" Class="glass-card p-8 rounded-2xl text-center animate-fade-in">
        <!-- Logout Icon -->
        <MudPaper Elevation="0"
            Class="w-24 h-24 mx-auto mb-6 bg-gradient-to-br from-purple-500 to-purple-700 rounded-2xl flex items-center justify-center shadow-[0_0_20px_rgba(139,92,246,0.3)] animate-pulse">
            <MudIcon Icon="@Icons.Material.Filled.Logout" Color="Color.Surface" Size="Size.Large" />
        </MudPaper>

        <!-- Text -->
        <MudStack Spacing="3" AlignItems="AlignItems.Center">
            <MudText Typo="Typo.h5" Class="font-bold bg-gradient-to-r from-purple-400 to-pink-500 bg-clip-text text-transparent">
                @L["Logout_LoggingOut"]
            </MudText>
            
            <MudText Typo="Typo.body1" Color="Color.Secondary">
                @L["Logout_PleaseWait"]
            </MudText>

            <!-- Progress Indicator -->
            <MudProgressCircular Size="Size.Large" Indeterminate="true" Color="Color.Primary" Class="mt-4" />

            <!-- Additional Message -->
            <MudText Typo="Typo.caption" Color="Color.Secondary" Class="mt-4">
                @L["Logout_RedirectMessage"]
            </MudText>
        </MudStack>
    </MudPaper>
</MudContainer>

@code {
    protected override async Task OnInitializedAsync()
    {
        try
        {
            var customProvider = (CustomAuthenticationStateProvider)AuthStateProvider;
            customProvider.Logout();

            await Task.Delay(1500); // زيادة الوقت قليلاً للتأثير البصري
            Navigation.NavigateTo("/login", replace: true);
        }
        catch (Exception ex)
        {
            Console.WriteLine($"[LOGOUT_ERROR] {ex.Message}");
            // في حالة حدوث خطأ، أعد التوجيه مباشرة
            Navigation.NavigateTo("/login", replace: true);
        }
    }
}